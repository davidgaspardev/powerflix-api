<!DOCTYPE html>
<html>
    <head>
        <title>POWERFLIX Server</title>
        <style>
            *, html, body {
                padding: 0;
                margin: 0;
                box-sizing: border-box;

                font-family: Roboto, sans-serif;
                
            }

            body {
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }

            label {
                margin-top: 10px;
                margin-left: 10px;
            }

            input, textarea {
                border: none;
                margin: 5px 5px 10px 5px;
                padding: 5px 10px;
                background-color: #00000010;
                border-radius: 5px;
                font-size: 14pt;
            }

            form, div {
                display: flex;
                flex-direction: column;

                max-width: 550px;
                width: 100%;
            }

            div#module-list > div, div.exercise-list > div {
                margin-top: 20px;
                padding: 16px;
                /* width: calc(100% - 32px); */
                background-color: #00000010;
                border-radius: 5px;
            }
        </style>
    </head>
    <body>
        <form id="form-cardflix">

            <label for="title">Título</label>
            <input id="title" name="title" type="text" placeholder="Ex: Bum bum na lua" required/>

            <label for="description">Descrição</label>
            <textarea id="description" name="description" type="text" rows="3" cols="33" placeholder="Ex: Para voçê quer ter um bum bum na lua" required></textarea>

            <label for="cover">Capa</label>
            <input id="cover" name="cover" type="file" accept="image/png, image/jpeg"/>

            <!-- <label for="cover">URL da capa</label>
            <input id="cover" name="cover" type="text" required/> -->

            <div>

                <div id="module-list"></div>

                <button id="button-more-module" type="button">Adicionar modulo</button>
            </div>

            <input type="submit" title="enviar cardflix"/>

        </form>
        <script>

            const cardflix = {
                title: "",
                description: "",
                cover: "",
                modules: []
            };

            const buttonMoreModule = document.getElementById("button-more-module");

            // Function to create module in the form
            // This function set onchange event to the inputs
            function createModule() {
                const moduleList = document.getElementById("module-list");
                // Adding module data struture
                const number = cardflix.modules.push({
                    level: "",
                    description: "",
                    frequency: {
                        repetition: 0,
                        series: 0
                    },
                    exercises: []
                });
                // Get module index
                const moduleIndex = number - 1;

                // Set ids
                const idModuleLevel = `level-${number}`;
                const idModuleDescription = `description-${number}`;
                const idModuleSeries = `series-${number}`;
                const idModuleRepetition = `repetition-${number}`;
                const idButtonMoreExercises = `button-${number}-more-exercise`;

                // Creating elemente to the module
                const div = document.createElement("div");
                div.innerHTML = `
                    <div>
                        <h4>Modulo ${number}</h4>

                        <label for="${idModuleLevel}">Level</label>
                        <input id="${idModuleLevel}" name="${idModuleLevel}" type="text" placeholder="Ex: LIGHT, SOFT ou HARD" required/>

                        <label for="${idModuleDescription}">Descrição</label>
                        <textarea id="${idModuleDescription}" name="${idModuleDescription}" type="text" rows="3" cols="33" placeholder="Ex: Carga leve contraindo o máximo possível a musculatura." required></textarea>

                        <label for="${idModuleSeries}">Serie</label>
                        <input id="${idModuleSeries}" name="${idModuleSeries}" type="number" placeholder="Ex: 3" required/>

                        <label for="${idModuleRepetition}">Repetição</label>
                        <input id="${idModuleRepetition}" name="${idModuleRepetition}" type="number" placeholder="Ex: 11" required/>

                        <div id="exercises-${number}" class="exercise-list"></div>

                        <button id="${idButtonMoreExercises}" type="button">Adicionar exercício</button>

                    </div>
                `;
                // Update DOM
                moduleList.append(div);

                // Set inputs
                document.getElementById(idModuleLevel).oninput = (event) => {
                    if(event) cardflix.modules[moduleIndex].level = event.target.value;
                }
                document.getElementById(idModuleDescription).oninput = (event) => {
                    if(event) cardflix.modules[moduleIndex].description = event.target.value;
                }
                document.getElementById(idModuleSeries).oninput = (event) => {
                    if(event) cardflix.modules[moduleIndex].series = Number.parseInt(event.target.value);
                }
                document.getElementById(idModuleRepetition).oninput = (event) => {
                    if(event) cardflix.modules[moduleIndex].repetition = Number.parseInt(event.target.value);
                }
                
                // Create the first exercise
                createExercise(moduleIndex);
                // Add event to create exercises
                document.getElementById(idButtonMoreExercises).onclick = () => {
                    createExercise(moduleIndex);
                }
            }

            function createExercise(moduleIndex) {
                const number = cardflix.modules[moduleIndex].exercises.push({
                    order: cardflix.modules[moduleIndex].exercises.length + 1,
                    name: "",
                    metadata: []
                });
                // Get exercise index
                const exerciseIndex = number  - 1;
                // Get module number
                const moduleNumber = moduleIndex + 1;

                cardflix.modules[moduleIndex].exercises[exerciseIndex].order = number;

                // Set ids
                const idExerciseName = `name-${number}`;
                const idExerciseMetadata = `metadata-${moduleNumber}-${number}`;

                const div = document.createElement("div");
                div.innerHTML = `
                    <div>
                        <h4>Exercício ${number}</h4>

                        <label for="${idExerciseName}">Nome</label>
                        <input id="${idExerciseName}" name="${idExerciseName}" type="text" placeholder="Ex: Agachamento búlgaro" required/>

                        <label for="${idExerciseMetadata}">Dados adicionais</label>
                        <input id="${idExerciseMetadata}" name="${idExerciseMetadata}" placeholder="Ex: BI-SET | 4x ATÉ A FALHA"/>
                    </div>
                `;

                document.getElementById(`exercises-${moduleNumber}`).append(div);

                // Set inputs
                document.getElementById(idExerciseName).oninput = (event) => {
                    if(event) cardflix.modules[moduleIndex].exercises[exerciseIndex].name = event.target.value;
                }
                document.getElementById(idExerciseMetadata).oninput = (event) => {
                    if(event) cardflix.modules[moduleIndex].exercises[exerciseIndex].metadata = event.target.value.split().filter((data) => data.length > 0);
                }
            }
            
            if(buttonMoreModule) {
                createModule();
                buttonMoreModule.onclick = () => createModule();

                document.getElementById("title").oninput = (event) => {
                    if(event) cardflix.title = event.target.value;
                }

                document.getElementById("description").oninput = (event) => {
                    if(event) cardflix.description = event.target.value;
                }
            }
        </script>
    </body>
</html>